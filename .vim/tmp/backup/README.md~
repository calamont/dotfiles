[![CircleCI](https://circleci.com/gh/klydo/klydo-utilities/tree/master.svg?style=svg&circle-token=71f52c79d17d5f2523a56e906a3a1059a35b3206)](https://circleci.com/gh/wai-chuen/klydo-utilities/tree/master)

# Klydo-utilities

Latest version: **v2.0.16**

This repo contains a shared python package for common functions across Klydo.

# Installation

Installing this package requires adding in the parameter `--extra-index-url` so pip knows where to find it. As it contains Klydo-specific sensitive info, we need to keep this private. We'll look into actual authenticated access in the future.

## Install via pip

```
  pip install klydo --extra-index-url https://pypi.klydo.io
```

Optional dependencies can also be installed for specific modules, depending on the requirement of the user.

### Clustering

To include dependencies for the `klydo.clustering` module, install using

```
  pip install klydo[clustering] --extra-index-url https://pypi.klydo.io
```

### Claims

To include dependencies for the `klydo.claims` module, install using

```
  pip install klydo[claims] --extra-index-url https://pypi.klydo.io
```

## Install via a `requirements.txt` file

Add in the extra url and the package

```
  --extra-index-url https://pypi.klydo.io
  klydo
  ...
```

**NOTE:** If you want to install extra dependencies (e.g. `klydo[clustering]`) through the `requirements.txt` file, do not include both `klydo` and `klydo[clustering]`, just include `klydo[clustering]` which fetches all regular dependencies too.

**NOTE:** Multiple extra dependencies can be declared with comma separation, for example:

```
  --extra-index-url https://pypi.klydo.io
  klydo[claims,clustering]==1.3.51
```

# Usage

Import the module (or submodules)

```
import klydo
from klydo.claims import processing
```

# Upgrading

1. Upgrade to the latest version with pip: `pip install --upgrade klydo`
2. If you have just made a change to the package, it can take a while for the cloudfront distribution that serves the actual files to update.
   If you want to test a new deployment immediately, run this python command instead of the above to point pip to the S3 bucket directly

```
pip install klydo --extra-index-url http://pypi.klydo.io.s3-website-eu-west-1.amazonaws.com --trusted-host pypi.klydo.io.s3-website-eu-west-1.amazonaws.com
```

# Contributing to the package

1. Clone this repo to your dev machine
2. Create a virtualenv and activate it (Use the name `env` as this is already included in the `.gitignore`)
   - `virtualenv env`
   - `source env/bin/activate`
3. Pip install the dependencies
   - `pip install -r requirements.txt`
4. Set up the pre-commit hooks (this runs the black formatter across all files on commit)
   - `pre-commit install`
5. Make sure you create a new branch for any updates
6. Increment the version number in setup.py following this schema:

```
Given a version number MAJOR.MINOR.PATCH, increment the:

MAJOR version when you make incompatible API changes,
MINOR version when you add functionality in a backwards-compatible manner, and
PATCH version when you make backwards-compatible bug fixes.
```

7. Create a new pull request. After successful checks & review, merge the branch into master
8. Updating the master branch will trigger a build and deploy workflow on [CircleCI](https://circleci.com/gh/wai-chuen/klydo-utilities/tree/master), which will automatically upload the package to s3

# Module documentation

See the individual directories for detailed documentation.

- [Elasticsearch](docs/es.md)
- [Amazon](docs/amazon.md)
- [Claims](docs/claims.md)
- [S3](docs/s3.md)
- [Google Sheets](sheets/README.md)
