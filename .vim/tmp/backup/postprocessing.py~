import os
import json
import klydo
import networkx as nx
from io import StringIO
from tempfile import NamedTemporaryFile
from datetime import datetime

def save(G, df):
    timestamp = datetime.now().strftime("%d-%m-%Y_%H-%M") 
    
    json_file = f"reviews/curated/evaluation_output/trees/{timestamp}_dendrogram.json"
    nodelink = nx.node_link_data(G)
    json_str = json.dumps(nodelink)
    klydo.s3.object.upload(bucket="klydo-data-acquisition",
                           key=json_file,
                           data=json_str)

    csv_file = "reviews/curated/evaluation_output/extractions/{timestamp}_extractions.csv"
    csv_buffer = StringIO() 
    df.to_csv(csv_buffer)
    klydo.s3.object.upload(bucket="klydo-data-acquisition",
                           key=csv_file,
                           data=csv_buffer.getvalue())

    s3_dir = "https://s3.console.aws.amazon.com/s3/object/klydo-data-acquisition/"
    return s3_dir + json_file, s3_dir + csv_file
